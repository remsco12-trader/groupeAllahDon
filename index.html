<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualisation Travailleurs / Non-Travailleurs</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { font-family: Arial, sans-serif; background: #f5f7fb; margin:0; }
    header { background:#4361ee; color:white; padding:20px; text-align:center; }
    h1 { margin:0; }
    .filter-bar { text-align:center; margin:20px 0; }
    select, input { padding:8px; border:1px solid #ccc; border-radius:5px; }
    select { margin-right:10px; }
    .container { max-width:1200px; margin:0 auto; padding:10px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; opacity: 0; transition: opacity 0.5s ease-in-out; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#4361ee; color:white; position:sticky; top:0; }
    .contact-card { 
        background:white; 
        border-radius:5px; 
        padding:12px; 
        margin:15px 0; 
        box-shadow:0 2px 5px rgba(0,0,0,0.1); 
        line-height:1.6;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    }
    .contact-card.visible { opacity: 1; transform: translateY(0); }
    .contact-detail i { width:20px; color:#4361ee; }
</style>
</head>
<body>

<!-- Image au-dessus du header -->
<div style="text-align:center; margin-top:10px;">
    <img src="https://raw.githubusercontent.com/remsco12-trader/groupeAllahDon/main/Logo.jpg" 
         alt="Logo" style="max-height:80px;">
</div>

<header>
    <h1>Annuaire de Begué Baara</h1>
</header>

<!-- Filtre déroulant + recherche -->
<div class="filter-bar">
    <select id="status-select">
        <option value="Travailleur">Travailleurs</option>
        <option value="Non Travailleur">Non Travailleur</option>
        <option value="Tous" selected>Tous</option>
    </select>
    <input type="text" id="search-input" placeholder="Rechercher un nom, une entreprise...">
</div>

<div class="container">
    <div id="contacts"></div>
    <table id="data-table">
        <thead></thead>
        <tbody></tbody>
    </table>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/1lQVgkO9AQ3l73MncVuSmIe4UO2LGAmWBXIAARTonQKY/gviz/tq?tqx=out:csv&gid=1936138638";

let rawData = [];
let currentStatus = "Tous";

const statusSelect = document.getElementById("status-select");
const searchInput = document.getElementById("search-input");

statusSelect.addEventListener("change", ()=>{ 
    currentStatus = statusSelect.value; 
    render();
});
searchInput.addEventListener("input", ()=>{ render(); });

function loadData(){
    Papa.parse(sheetUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results){
            rawData = results.data;
            render();
        },
        error: function(err){
            alert("Erreur chargement: "+err.message);
        }
    });
}

function render(){
    const contactsDiv = document.getElementById("contacts");
    const table = document.getElementById("data-table");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");

    const searchText = (searchInput.value || "").toLowerCase();

    // Filtrer selon le statut
    let filtered = rawData;
    if(currentStatus !== "Tous"){
        filtered = rawData.filter(r => (r.Statut||"").toLowerCase() === currentStatus.toLowerCase());
    }

    // Filtrer selon recherche
    if(searchText){
        filtered = filtered.filter(person => 
            Object.values(person).some(val => 
                (val || "").toLowerCase().includes(searchText)
            )
        );
    }

    // --- CONTACT CARDS ---
    contactsDiv.innerHTML = "";
    filtered.forEach(person=>{
        let formationLine = `<div class="contact-detail"><i class="fas fa-school"></i> ${person.Formation||""}</div>`;
        let professionLine = `<div class="contact-detail"><i class="fas fa-briefcase"></i> ${person.Profession||""}</div>`;
        let entrepriseLine = `<div class="contact-detail"><i class="fas fa-building"></i> ${person.Entreprise||""}</div>`;

        if(currentStatus === "Travailleur"){ formationLine = ""; }
        if(currentStatus === "Non Travailleur"){ professionLine = ""; entrepriseLine = ""; }

        const card = document.createElement("div");
        card.className="contact-card";
        card.innerHTML = `
            <div><strong>${person["Nom et prénoms"]||""}</strong></div>
            <div class="contact-detail"><i class="fas fa-phone"></i> ${person.Contact||""}</div>
            ${professionLine}
            ${entrepriseLine}
            ${formationLine}
            <div class="contact-detail"><i class="fas fa-map-marker-alt"></i> ${person.Quartier||""}, ${person.Pays||""}</div>
            <div class="contact-detail"><i class="fas fa-globe"></i> ${person.Région||""}</div>
        `;
        contactsDiv.appendChild(card);
        setTimeout(()=>{ card.classList.add("visible"); }, 50);
    });

    // --- TABLEAU ---
    thead.innerHTML = "";
    tbody.innerHTML = "";
    table.style.opacity = 0; 
    if(rawData.length>0){
        let headers = Object.keys(rawData[0]);
        headers = headers.filter(h => h !== "Horodateur" && h !== "Statut");

        if(currentStatus === "Travailleur"){
            headers = headers.filter(h => h !== "Formation");
        } else if(currentStatus === "Non Travailleur"){
            headers = headers.filter(h => h !== "Profession" && h !== "Entreprise");
        }

        const trHead = document.createElement("tr");
        headers.forEach(h=>{
            const th = document.createElement("th");
            th.textContent = h;
            trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        filtered.forEach(row=>{
            const tr = document.createElement("tr");
            headers.forEach(h=>{
                const td = document.createElement("td");
                td.textContent = row[h] || "";
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });

        setTimeout(()=>{ table.style.opacity = 1; }, 50);
    }
}

// Charger les données
loadData();
</script>
</body>
</html>

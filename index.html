<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualisation Travailleurs / Non-Travailleurs</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { font-family: Arial, sans-serif; background: #f5f7fb; margin:0; }
    header { background:#4361ee; color:white; padding:20px; text-align:center; }
    header img { max-height:80px; display:block; margin:0 auto 10px; }
    h1 { margin-bottom:5px; }
    .status-btns { display:flex; justify-content:center; margin:20px 0; gap:10px; }
    .status-btn { padding:10px 20px; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:bold; }
    .worker-btn { background:#4cc9f0; } 
    .non-worker-btn { background:#7209b7; } 
    .all-btn { background:#4ade80; }
    .status-btn.active { box-shadow:0 0 0 3px rgba(0,0,0,0.2); }
    .container { max-width:1200px; margin:0 auto; padding:10px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#4361ee; color:white; position:sticky; top:0; }
    .contact-card { 
        background:white; 
        border-radius:5px; 
        padding:12px; 
        margin:15px 0;  /* âœ… plus dâ€™espace entre les cartes */
        box-shadow:0 2px 5px rgba(0,0,0,0.1); 
    }
    .contact-detail { margin: 4px 0; } /* âœ… un peu dâ€™espace entre les lignes */
    .contact-detail i { width:20px; color:#4361ee; }
</style>
</head>
<body>

<header>
    <img src="https://drive.google.com/file/d/1YaTFINCi0WXsvsRo2ZL9LHO5EV0Vl4lr/view?usp=sharing">
    <h1>Annuaire de BeguÃ© Baara</h1>
</header>

<div class="status-btns">
    <button class="status-btn worker-btn active" id="worker-btn">Travailleurs</button>
    <button class="status-btn non-worker-btn" id="non-worker-btn">Non Travailleur</button>
    <button class="status-btn all-btn" id="all-btn">Tous</button>
</div>

<!-- ðŸ”Ž Barre de recherche -->
<div style="text-align:center; margin: 10px 0 20px 0;">
    <input type="text" id="search-input" placeholder="Rechercher un nom, une entreprise..." 
           style="padding:8px; width:60%; border:1px solid #ccc; border-radius:5px;">
</div>

<div class="container">
    <div id="contacts"></div>
    <table id="data-table">
        <thead></thead>
        <tbody></tbody>
    </table>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/1lQVgkO9AQ3l73MncVuSmIe4UO2LGAmWBXIAARTonQKY/gviz/tq?tqx=out:csv&gid=1936138638";

let rawData = [];
let currentStatus = "Travailleur";

const workerBtn = document.getElementById("worker-btn");
const nonWorkerBtn = document.getElementById("non-worker-btn");
const allBtn = document.getElementById("all-btn");
const searchInput = document.getElementById("search-input");

// âœ… gestion des boutons
workerBtn.addEventListener('click', ()=>{
    currentStatus="Travailleur"; 
    setActiveBtn(workerBtn); 
    hideOtherButtons(workerBtn);
    render();
});
nonWorkerBtn.addEventListener('click', ()=>{
    currentStatus="Non Travailleur"; 
    setActiveBtn(nonWorkerBtn); 
    hideOtherButtons(nonWorkerBtn);
    render();
});
allBtn.addEventListener('click', ()=>{
    currentStatus="Tous"; 
    setActiveBtn(allBtn); 
    hideOtherButtons(allBtn);
    render();
});

function setActiveBtn(btn){
    [workerBtn, nonWorkerBtn, allBtn].forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
}

// âœ… masquer les autres boutons
function hideOtherButtons(activeBtn){
    [workerBtn, nonWorkerBtn, allBtn].forEach(b=>{
        if(b !== activeBtn){ 
            b.style.display="none"; 
        } else { 
            b.style.display="inline-block"; 
        }
    });
}

// âœ… recherche en direct
searchInput.addEventListener("input", () => {
    render();
});

function loadData(){
    Papa.parse(sheetUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results){
            rawData = results.data;
            console.log("DonnÃ©es chargÃ©es:", rawData);
            render();
        },
        error: function(err){
            alert("Erreur chargement: "+err.message);
        }
    });
}

function render(){
    const contactsDiv = document.getElementById("contacts");
    const table = document.getElementById("data-table");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");

    const searchText = (searchInput.value || "").toLowerCase();

    // Filtrer selon le statut
    let filtered = rawData;
    if(currentStatus !== "Tous"){
        filtered = rawData.filter(r => (r.Statut||"").toLowerCase() === currentStatus.toLowerCase());
    }

    // Filtrer selon recherche
    if(searchText){
        filtered = filtered.filter(person => 
            Object.values(person).some(val => 
                (val || "").toLowerCase().includes(searchText)
            )
        );
    }

    // Rendu des contacts
    contactsDiv.innerHTML = "";
    filtered.forEach(person=>{
        const card = document.createElement("div");
        card.className="contact-card";

        let professionLine = `<div class="contact-detail"><i class="fas fa-briefcase"></i> ${person.Profession||""}</div>`;
        let formationLine = `<div class="contact-detail"><i class="fas fa-school"></i> ${person.Formation||""}</div>`;

        // âœ… cacher certaines lignes selon le bouton choisi
        if(currentStatus === "Travailleur"){ 
            formationLine = ""; 
        }
        if(currentStatus === "Non Travailleur"){ 
            professionLine = ""; 
        }

        card.innerHTML = `
            <div><strong>${person["Nom et prÃ©noms"]||""}</strong></div>
            <div class="contact-detail"><i class="fas fa-phone"></i> ${person.Contact||""}</div>
            ${professionLine}
            <div class="contact-detail"><i class="fas fa-building"></i> ${person.Entreprise||""}</div>
            ${formationLine}
            <div class="contact-detail"><i class="fas fa-map-marker-alt"></i> ${person.Quartier||""}, ${person.Pays||""}</div>
            <div class="contact-detail"><i class="fas fa-globe"></i> ${person.RÃ©gion||""}</div>
        `;
        contactsDiv.appendChild(card);
    });

    // Rendu du tableau
    thead.innerHTML = "";
    tbody.innerHTML = "";
    if(rawData.length>0){
        const headers = Object.keys(rawData[0]);
        const trHead = document.createElement("tr");
        headers.forEach(h=>{
            const th = document.createElement("th");
            th.textContent = h;
            trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        filtered.forEach(row=>{
            const tr = document.createElement("tr");
            headers.forEach(h=>{
                const td = document.createElement("td");
                td.textContent = row[h] || "";
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }
}

// Charger les donnÃ©es au dÃ©marrage
loadData();
</script>
</body>
</html>

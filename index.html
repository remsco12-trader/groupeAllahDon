<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualisation Travailleurs / Non-Travailleurs</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { font-family: Arial, sans-serif; background: #f5f7fb; margin:0; }
    header { background:#4361ee; color:white; padding:20px; text-align:center; }
    header img { max-height:80px; display:block; margin:0 auto 10px; }
    h1 { margin-bottom:5px; }
    .status-btns { display:flex; justify-content:center; margin:20px 0; gap:10px; }
    .status-btn { padding:10px 20px; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:bold; }
    .worker-btn { background:#4cc9f0; } .non-worker-btn { background:#7209b7; } .all-btn { background:#4ade80; }
    .status-btn.active { box-shadow:0 0 0 3px rgba(0,0,0,0.2); }
    .container { max-width:1200px; margin:0 auto; padding:10px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#4361ee; color:white; position:sticky; top:0; }
    .contact-card { background:white; border-radius:5px; padding:10px; margin:10px 0; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .contact-detail i { width:20px; color:#4361ee; }
</style>
</head>
<body>

<header>
    <img src="https://via.placeholder.com/150x80?text=Logo" alt="Logo">
    <h1>Visualisation Travailleurs / Non Travailleur</h1>
</header>

<div class="status-btns">
    <button class="status-btn worker-btn active" id="worker-btn">Travailleurs</button>
    <button class="status-btn non-worker-btn" id="non-worker-btn">Non Travailleur</button>
    <button class="status-btn all-btn" id="all-btn">Tous</button>
</div>

<div class="container">
    <div id="contacts"></div>
    <table id="data-table">
        <thead></thead>
        <tbody></tbody>
    </table>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/1lQVgkO9AQ3l73MncVuSmIe4UO2LGAmWBXIAARTonQKY/gviz/tq?tqx=out:csv&gid=1936138638"; // <-- remplacer

let rawData = [];
let currentStatus = "Travailleur";

const workerBtn = document.getElementById("worker-btn");
const nonWorkerBtn = document.getElementById("non-worker-btn");
const allBtn = document.getElementById("all-btn");

workerBtn.addEventListener('click', ()=>{currentStatus="Travailleur"; setActiveBtn(workerBtn); render();});
nonWorkerBtn.addEventListener('click', ()=>{currentStatus="Non Travailleur"; setActiveBtn(nonWorkerBtn); render();});
allBtn.addEventListener('click', ()=>{currentStatus="Tous"; setActiveBtn(allBtn); render();});

function setActiveBtn(btn){
    [workerBtn, nonWorkerBtn, allBtn].forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
}

function loadData(){
    Papa.parse(sheetUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results){
            rawData = results.data;
            console.log("Données chargées:", rawData); // <-- Vérifier ici
            render();
        },
        error: function(err){
            alert("Erreur chargement: "+err.message);
        }
    });
}

function render(){
    const contactsDiv = document.getElementById("contacts");
    const table = document.getElementById("data-table");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");

    // Filtrer selon le statut
    let filtered = rawData;
    if(currentStatus !== "Tous"){
        filtered = rawData.filter(r => (r.Statut||"").toLowerCase() === currentStatus.toLowerCase());
    }

    // Rendu des contacts
    contactsDiv.innerHTML = "";
    filtered.forEach(person=>{
        const card = document.createElement("div");
        card.className="contact-card";
        card.innerHTML = `
            <div><strong>${person["Nom et prénoms"]||""}</strong></div>
            <div class="contact-detail"><i class="fas fa-phone"></i> ${person.Contact||""}</div>
            <div class="contact-detail"><i class="fas fa-briefcase"></i> ${person.Profession||""}</div>
            <div class="contact-detail"><i class="fas fa-building"></i> ${person.Entreprise||""}</div>
            <div class="contact-detail"><i class="fas fa-school"></i> ${person.Formation||""}</div>
            <div class="contact-detail"><i class="fas fa-map-marker-alt"></i> ${person.Quartier||""}, ${person.Pays||""}</div>
            <div class="contact-detail"><i class="fas fa-globe"></i> ${person.Région||""}</div>
        `;
        contactsDiv.appendChild(card);
    });

    // Rendu du tableau
    thead.innerHTML = "";
    tbody.innerHTML = "";
    if(rawData.length>0){
        const headers = Object.keys(rawData[0]);
        const trHead = document.createElement("tr");
        headers.forEach(h=>{
            const th = document.createElement("th");
            th.textContent = h;
            trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        filtered.forEach(row=>{
            const tr = document.createElement("tr");
            headers.forEach(h=>{
                const td = document.createElement("td");
                td.textContent = row[h] || "";
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }
}

// Charger les données au démarrage
loadData();
</script>
</body>
</html>





